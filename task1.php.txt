<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Task 1 – Customer Feedback</title>
</head>
<body>
<?php include 'menu.inc'; ?>

<h2>Task 1 – Customer Feedback Form (GET)</h2>
<p><em>All fields required except comments.</em></p>

<?php
// ---------------- Task 1 processing (runs after submit) ----------------
// helper to tidy inputs safely
function clean_input($v){ return htmlspecialchars(trim($v ?? ""), ENT_QUOTES, 'UTF-8'); }

$submitted = isset($_GET['submit']);
$errors = [];
$result  = "";

if ($submitted){
  $shop     = clean_input($_GET['shop'] ?? "");
  $name     = clean_input($_GET['name'] ?? "");
  $email    = clean_input($_GET['email'] ?? "");
  $rating   = clean_input($_GET['rating'] ?? "");
  $comments = clean_input($_GET['comments'] ?? "");

  if ($shop === "")   { $errors[] = "Please select a shop."; }
  if ($name === "")   { $errors[] = "Please enter your name."; }
  if ($email === "")  { $errors[] = "Please enter your email."; }
  if ($rating === "") { $errors[] = "Please choose a rating."; }

  if ($errors){
    echo "<p style='color:#b00020'><strong>Form incomplete:</strong><br>".implode("<br>", $errors)."</p>";
  } else {
    // build the neat paragraph BELOW the form (we’ll echo $result after the form)
    $result = "<p style='background:#f6f6f6; padding:10px; border:1px solid #ddd'>
      <strong>Feedback received</strong><br>
      Shop: $shop<br>
      Name: $name<br>
      Email: $email<br>
      Rating: $rating<br>
      Comments: ".($comments!=="" ? $comments : "No comments provided")."
    </p>";
  }
}
?>

<form method="get" action="">
  <label for="shop">Select Shop:</label>
  <select id="shop" name="shop">
    <option value="">--Choose--</option>
    <?php
      $branches = ["Branch A","Branch B","Branch C","Branch D","Branch E"];
      $sel = $_GET['shop'] ?? "";
      foreach($branches as $b){
        $s = ($b===$sel) ? "selected" : "";
        echo "<option $s value=\"$b\">$b</option>";
      }
    ?>
  </select><br><br>

  <label for="name">Customer Name:</label>
  <input id="name" name="name" type="text" value="<?php echo htmlspecialchars($_GET['name'] ?? ""); ?>"><br><br>

  <label for="email">Customer Email:</label>
  <input id="email" name="email" type="email" value="<?php echo htmlspecialchars($_GET['email'] ?? ""); ?>"><br><br>

  <label>Rating (1 = poor, 5 = excellent):</label><br>
  <?php
    $rsel = $_GET['rating'] ?? "";
    for($i=1;$i<=5;$i++){
      $ck = ($rsel==(string)$i) ? "checked" : "";
      echo "<label><input type='radio' name='rating' value='$i' $ck> $i</label> ";
    }
  ?>
  <br><br>

  <label for="comments">Justification (optional):</label><br>
  <textarea id="comments" name="comments" rows="4" cols="50"><?php
    echo htmlspecialchars($_GET['comments'] ?? "");
  ?></textarea><br><br>

  <input type="submit" name="submit" value="Submit Feedback">
</form>

<?php
// show the neat paragraph BELOW the form if valid
if ($submitted && $result !== "") { echo $result; }
?>

<!-- centered iframe with exact size -->
<div style="text-align:center; margin-top:30px;">
  <iframe src="task1.txt" width="1200" height="400">Your browser does not support iframes.</iframe>
</div>
</body>
</html>
